<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>BhoomiTech Heritage & Development Foundation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="manifest" href="manifest.json">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body { margin:0; font-family: Arial, sans-serif; }
    header {
      background:#004d40;
      color:white;
      padding:12px;
      text-align:center;
      font-weight:bold;
    }
    #map { height:50vh; }
    .container { padding:15px; }
    input, button {
      width:100%;
      padding:12px;
      margin-top:10px;
      font-size:16px;
    }
    button {
      background:#00695c;
      color:white;
      border:none;
      border-radius:5px;
    }
  </style>
</head>
<body>

<header>
  BhoomiTech Heritage & Development Foundation
</header>

<div id="map"></div>

<div class="container">
  <button onclick="useLocation()">Use My Location</button>

  <input type="text" id="lat" placeholder="Latitude">
  <input type="text" id="lng" placeholder="Longitude">

  <button onclick="openStreetView()">Open Street View</button>

  <input type="text" id="name" placeholder="Your Name">
  <input type="text" id="phone" placeholder="WhatsApp Number">
  <textarea id="description"></textarea>

  <button onclick="submitData()">Submit</button>
</div>

<script>
let map = L.map('map').setView([20.5937, 78.9629], 5);
let marker;

// Satellite layer
L.tileLayer(
  'https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}',
  { maxZoom: 20 }
).addTo(map);

// Map click â†’ set marker
map.on('click', function(e) {
  setMarker(e.latlng.lat, e.latlng.lng);
});

// Function to set or move marker
function setMarker(lat, lng) {
  lat = parseFloat(lat);
  lng = parseFloat(lng);

  if (isNaN(lat) || isNaN(lng)) return;

  if (marker) {
    marker.setLatLng([lat, lng]);
  } else {
    marker = L.marker([lat, lng]).addTo(map);
  }

  map.setView([lat, lng], 20);

  document.getElementById('lat').value = lat.toFixed(6);
  document.getElementById('lng').value = lng.toFixed(6);
}

// Use GPS
function useLocation() {
  navigator.geolocation.getCurrentPosition(function(position) {
    const lat = position.coords.latitude;
    const lng = position.coords.longitude;
    setMarker(lat, lng);
  });
}

// Update marker when coordinates edited manually
function updateFromInputs() {
  const lat = document.getElementById('lat').value;
  const lng = document.getElementById('lng').value;
  setMarker(lat, lng);
}

// Attach listeners (fires when user finishes editing)
document.getElementById('lat').addEventListener('change', updateFromInputs);
document.getElementById('lng').addEventListener('change', updateFromInputs);

// Optional: live update while typing
document.getElementById('lat').addEventListener('input', updateFromInputs);
document.getElementById('lng').addEventListener('input', updateFromInputs);

// Street View
function openStreetView() {
  const lat = document.getElementById('lat').value;
  const lng = document.getElementById('lng').value;

  if(!lat || !lng) {
    alert("Select or enter coordinates first");
    return;
  }

  window.open(
    `https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${lat},${lng}`,
    '_blank'
  );
}

// Submit
function submitData() {
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const lat = document.getElementById('lat').value;
  const lng = document.getElementById('lng').value;

  if (!name || !phone || !lat || !lng) {
    alert("Please complete all fields and select location");
    return;
  }

  const data = { name, phone, lat, lng };
  console.log("Submitted:", data);

  alert("Submission Successful!");
}
</script>
<script type="module">
  import { initializeApp } from 
  "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

  import { getFirestore, collection, addDoc, serverTimestamp }
  from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBhDODHvzxAWPXuxrKA_aZfKHZbGXbXF2k",
    authDomain: "bhoomitech-field.firebaseapp.com",
    projectId: "bhoomitech-field",
    storageBucket: "bhoomitech-field.firebasestorage.app",
    messagingSenderId: "815695507485",
    appId: "1:815695507485:web:6e9d8d6112d6ef9173d6f4"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.submitData = async function() {

    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const description = document.getElementById('description').value.trim();
    const lat = parseFloat(document.getElementById('lat').value);
    const lng = parseFloat(document.getElementById('lng').value);

    if (!name || !phone || !lat || !lng) {
      alert("Please complete all required fields.");
      return;
    }

    try {
      await addDoc(collection(db, "submissions"), {
        name,
        phone,
        description,
        lat,
        lng,
        timestamp: serverTimestamp()
      });

      alert("Submission Successful!");
      location.reload();

    } catch (error) {
      console.error(error);
      alert("Error submitting data.");
    }
  };
</script>
</body>
</html>
